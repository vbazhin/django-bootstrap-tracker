<!DOCTYPE html>
<html lang="en">
    <head>
        <title> tracker </title>
        <link rel="stylesheet" href="{{ STATIC_URL }}bootstrap/css/bootstrap.css" type="text/css" media="screen" />
        <link rel="stylesheet" href="{{ STATIC_URL }}bootstrap/css/timepicker.css" type="text/css" media="screen" />
        <link rel="stylesheet" href="{{ STATIC_URL }}bootstrap/css/bootstrap-responsive.css" type="text/css" media="screen" />
        <link rel="stylesheet" href="{{ STATIC_URL }}css/jquery-ui-1.8.18.custom.css" type="text/css" media="screen" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="{{ STATIC_URL }}jq/jquery-1.7.2.min.js"> </script>
        <script src="{{ STATIC_URL }}jq/jquery-ui-1.8.18.custom.min.js"> </script>
        <script src="{{ STATIC_URL }}bootstrap/js/bootstrap.js"> </script>
        <script src="{{ STATIC_URL }}bootstrap/js/bootstrap-modal.js"> </script>
        <script src="{{ STATIC_URL }}bootstrap/js/bootstrap-datepicker.js"></script>
        <script src="{{ STATIC_URL }}bootstrap/js/bootstrap-timepicker.js"></script>
        {% load markup %}
        {% load markitup_tags %}
        {% markitup_media "no-jquery" %}
        <link rel="stylesheet" href="{{ STATIC_URL }}css/style.css" type="text/css" media="screen" />
        <script>
            function hideModal() {
                $('#add-task').hide()
            }
            function showModal() {
                $('#add-task').slideToggle()
            }
        </script>

        <script>
            function generate_reg_link() {
                $.ajax({
                    type: "POST",
                    url: "/register_link/",
                    data: {
                    },
                    success: function(result) {
                        $('#link-modal .modal-body').empty()
                        $('#link-modal .modal-body').append(result)
                        showLink(result)
                    }
                })
            }
        </script>
        <script>
            function hideLink() {
                $('#link-modal').hide()
            }

            function showLink() {
                $('#link-modal').show()
            }
        </script>
        <script>
            /* Update datepicker plugin so that MM/DD/YYYY format is used. НЕ МОЙ КОД */
            $.extend($.fn.datepicker.defaults, {
                parse: function (string) {
                    var matches;
                    if ((matches = string.match(/^(\d{2,2})\/(\d{2,2})\/(\d{4,4})$/))) {
                        return new Date(matches[3], matches[1] - 1, matches[2]);
                    } else {
                        return null;
                    }
                },
                format: function (date) {
                    var
                            month = (date.getMonth() + 1).toString(),
                            dom = date.getDate().toString();
                    if (month.length === 1) {
                        month = "0" + month;
                    }
                    if (dom.length === 1) {
                        dom = "0" + dom;
                    }
                    return month + "/" + dom + "/" + date.getFullYear();
                }
            });
        </script>

        <script>
            function disableReceivers() {
                if (document.getElementById('id_receiver').disabled == false) {
                    document.getElementById('id_receiver').disabled = true
                }
                else {
                    document.getElementById('id_receiver').disabled = false
                }
                // Переделать с атирибутами
            }

            function disableExpiration() {
                if (document.getElementById('expiration-date').disabled == false) {
                    document.getElementById('expiration-date').disabled = true
                    document.getElementById('expiration-time').disabled = true
                }
                else {
                    document.getElementById('expiration-date').disabled = false
                    document.getElementById('expiration-time').disabled = false

                }
                // Переделать с атирибутами
            }
        </script>
    </head>
    <body>
        <div class="hero">
        </div>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <div>
                        <a class="brand" href="/">
                            Задания v0.4
                        </a>
                        <div class="user-logout" >
                            {{ user.username }} <a href='logout/'> Выйти </a>
                        </div>
                        {% if page_type == 'index' %}
                        <div class="add-user">
                            <a href="#" class="btn" onclick="showModal()"> <i class="icon-plus"> </i> Добавить  </a>
                        </div>
                        {% else %}
                        <div class="add-user" >
                                <a href="/add_task" name="add_task" class="btn"> <i class="icon-plus"> </i> Добавить </a>
                        </div>
                        {% endif %}
                        {% if user.username == 'admin' %}
                        <div class="invite-user" >
                            <a href="#" class="btn" onclick="generate_reg_link()" > Приглашение </a>
                        </div>
                        <div>
                            <div id="link-modal" class="modal" style="display:none;">
                                <a class="close" data-dismiss="modal" onclick="hideLink()" style="margin:8px 10px;" >×</a>
                                <div class="modal-body">
                                </div>
                                <div class="modal-footer">
                                    <a href="#" class="btn" onclick="hideLink()">Закрыть</a>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <div class="nav-collapse issue-navigation">
                            <ul class="nav">
                                <li><a href="/">Все</a></li>
                                <li><a href="/current">Текущие</a></li>
                                <li><a href="/new">Новые <span class="badge badge-warning">{{ new_num }}</span></a></li>
                                <li><a href="/taken">В работе <span class="badge badge-info">{{ taken_num }}</span> </a></li>
                                <li><a href="/check">На проверку <span class="badge badge-success">{{ check_num }}</span></a></li>
                                <li class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                        Остальные
                                        <b class="caret"></b>
                                    </a>
                                    <ul class="dropdown-menu">
                                        <li><a href="/done">Отправленные на проверку <span class="badge badge-success">{{ oncheck_num }}</span></a></li>
                                        <li><a href="/givenbyme">Заданные мной </a></li>
                                        <li><a href="/success">Выполненные успешно</a></li>
                                        <li><a href="/failed">Невыполенные</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>